<%version 1%>
<%description
    <b>Data: </b>Project Status<br>
    <b>Notes: </b>This report displays project status.<br>
%>
<%param 
    name="reporttitle" 
    type="String" 
    prompt="Report Title" 
    value="Inline Project Status" 
    description="Descriptive title for your report."
%>
<%param
    name="reportheader" 
    type="MultiString" 
    prompt="Report Header" 
    value="" 
    description="Text appearing at the top of the report page."
%>
<%param
    name="reportfooter" 
    type="MultiString" 
    prompt="Report Footer" 
    value="" 
    description="Text appearing at the bottom of the report page."
%>

<html>
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>&reporttitle</title>
    <%screenStyleSheet%>
    <%printerStyleSheet%>
	<script type="text/javascript">
		var REPORT_ISSUES = "";
		
		function getImgTag(health){
			return "<img src='<%hosturl%>MKS_ALM_2009/" + health.toLowerCase() + ".gif' alt='" + health + "'/>";
		}
		
		var ProjectDate = [];
		var RiskDate = [{"Open":0},{"In Analysis":0},{"Rejected":0},{"Analyzed":0},{"In Monitoring":0},{"Postponed":0},{"Cloesd":0}];
		
		var DefectDate = [];
		var DefectTypeData = {
			"Function" :[{"Requirement":0},{"System Architecture":0},{"System Architecture":0},{"Software Detailed Design":0},{"Code":0},{"Test":0},
			{"Software Integration":0},{"System Integration":0}],
			"Logical" :[{"Requirement":0},{"System Architecture":0},{"System Architecture":0},{"Software Detailed Design":0},{"Code":0},{"Test":0},
			{"Software Integration":0},{"System Integration":0}],
			"Norms" :[{"Requirement":0},{"System Architecture":0},{"System Architecture":0},{"Software Detailed Design":0},{"Code":0},{"Test":0},
			{"Software Integration":0},{"System Integration":0}],
			"Interface" :[{"Requirement":0},{"System Architecture":0},{"System Architecture":0},{"Software Detailed Design":0},{"Code":0},{"Test":0},
			{"Software Integration":0},{"System Integration":0}],
			"Performance" :[{"Requirement":0},{"System Architecture":0},{"System Architecture":0},{"Software Detailed Design":0},{"Code":0},{"Test":0},
			{"Software Integration":0},{"System Integration":0}],
			"Grammer" :[{"Requirement":0},{"System Architecture":0},{"System Architecture":0},{"Software Detailed Design":0},{"Code":0},{"Test":0},
			{"Software Integration":0},{"System Integration":0}],
			"Design Defect" :[{"Requirement":0},{"System Architecture":0},{"System Architecture":0},{"Software Detailed Design":0},{"Code":0},{"Test":0},
			{"Software Integration":0},{"System Integration":0}],
		}
		var ChangeRequestDate = [];
		var ChangeOrderDate = [];
	</script>
</head>
<%dateformat MM/dd/yy HH:mm:ss%>
<%datetimeformat MM/dd/yyyy h:mm:ss a%>
<body style="padding:2% 5% 2% 5%; ">
<%begindetail%>

<script>
	//Project数据
	if("<%<%builtin Type%>%>" == "Project"){
		ProjectDate.push({"projectType" : "<%<%builtin Type%>%>"});
		ProjectDate.push({"projectId" : "<%<%builtin ID%>%>"});
		ProjectDate.push({"builtinSummary" : "<%<%builtin Summary%>%>"});
	}
	
    //risk数据
	if("<%<%builtin Type%>%>" == "Risk"){
		for(var i=0;i<RiskDate.length;i++){
			var obj = RiskDate[i];
			var key = Object.keys(obj)[0];
			var count = parseInt(obj[key]);
			if("<%State%>" == key){
				obj[key] = count+1;
			}
		}
	}
	//Defect数据
	if("<%<%builtin Type%>%>" == "Defect"){
		for(var key in DefectTypeData){ 
			if("<%Defect Type%>" == key){
				var arr = DefectTypeData[key];
				for(var i = 0;i<arr.length;i++){
					var obj = arr[i];
					//console.log(obj);
					if("<%Defect Source%>" == Object.keys(obj)[0]){
						var count = parseInt(obj["<%Defect Source%>"]);
						//console.log(count);
						obj["<%Defect Source%>"] = count+1;
						
					}
					//console.log(obj);
				}
			}
		}

		DefectDate.push({"DefectType" : "<%Defect Type%>"});
		DefectDate.push({"DefectSource" : "<%Defect Source%>"});
		DefectDate.push({"Origin" : "<%Origin%>"});
		DefectDate.push({"State" : "<%State%>"});
		DefectDate.push({"TaskPhase" : "<%Task Phase%>"});
		DefectDate.push({"defectState" : "<%defectState%>"});
		DefectDate.push({"Responsibility Team" : "<%Responsibility Team%>"});
	}
	//Change Request数据 
    if("<%<%builtin Type%>%>" == "Change Request"){
		ChangeRequestDate.push({"State" : "<%State%>"});
		ChangeRequestDate.push({"ChangeCategory" : "<%Change Category%>"});
		ChangeRequestDate.push({"ChangeInitiator" : "<%Change Initiator%>"});
	} 
	
	//Change Order数据   
    if("<%<%builtin Type%>%>" == "Change Order"){
		ChangeOrderDate.push({"State" : "<%State%>"});
	} 

</script>
<%enddetail%>

<table class="detailrows fullWidth">
<!-- Risk start -->
	<tr>
		<td colspan="2" style="padding: 2px 8px; background-color: #B6CCDD; font-weight: bold; text-align: center">
			<b>Risk Metrics</b></td>
		</tr>
	<tr>
		<td>
			<table class="detailrows">
				<tr class="even_row"><th nowrap>Open:</th><td width="100%" id = "RiskStateOpen">0</td></tr>
				<tr class="odd_row"><th nowrap>In Analysis:</th><td width="100%" id = "RiskStateInAnalysis"> 0</td></tr>
				<tr class="even_row"><th nowrap>Rejected:</th><td width="100%" id = "RiskStateRejected"> 0</td></tr>
				<tr class="odd_row"><th nowrap>Analyzed:</th><td width="100%" id = "RiskStateAnalyzed">0 </td></tr>
				
			</table>
		</td>
		<td valign="top">
			<table class="detailrows">
				<tr class="even_row"><th nowrap>In Monitoring:</th><td width="100%" id = "RiskStateInMonitoring"> 0</td></tr>
				<tr class="odd_row"><th nowrap>Postponed:</th><td width="100%" id = "RiskStatePostponed"> 0</td></tr>
				<tr class="even_row"><th nowrap>Cloesd:</th><td width="100%" id = "RiskStateCloesd">0</td></tr>
			</table>
		</td>
	</tr>
<!-- Risk end -->
	
<!-- Defect start -->
	<tr><td>&nbsp;</td></tr>
	<tr>
		<td colspan="2" style="padding: 2px 8px; background-color: #B6CCDD; font-weight: bold; text-align: center">
			<b>Defect Metrics</b>
		</td> 
	</tr>
	<tr>
		<td style="width: 100%;" colspan="2">
			<table class="detailcols" style="width: 100%;">
				<tr class="even_row" style="width: 100%;">
					<th style="text-align:center; width: 30%" ></th>
					<th style="text-align:center; " >Requirement</th>
					<th style="text-align:center; " >System Architecture</th>
					<th style="text-align:center; " >Software Architecture</th>
					<th style="text-align:center; " >Software Detailed Design</th>
					<th style="text-align:center; " >Code</th>
					<th style="text-align:center; " >Test</th>
					<th style="text-align:center; " >Software Integration</th>
					<th style="text-align:center; " >System Integration</th>
				</tr>
				<tbody id = "defectTypeAndSousce">
					<tr class="odd_row" style="width: 100%;">
						<th style="text-align:right; width: 30%">Function:</th>
						<td style="text-align:center; "> 1</td>
						<td style="text-align:center; "> 2</td>
						<td style="text-align:center; ">3 </td>
						<td style="text-align:center; "> 4</td>
						<td style="text-align:center; "> 5</td>
						<td style="text-align:center; "> 6</td>
						<td style="text-align:center; "> 7</td>
						<td style="text-align:center; "> 8</td>
					</tr>
				</tbody>
			</table>
		</td>
	</tr>
	<!-- Defect end -->

	
</table>
</body>
<script>
	console.log(ProjectDate);
	console.log(RiskDate);
	console.log(DefectDate);
	console.log(ChangeOrderDate);
	console.log(ChangeRequestDate);
	console.log(DefectTypeData);
    getRiskDate();
	getDefectDate();

	function getDefectDate(){
		//var DefectSource = ["Requirement","System Architecture","Software Architecture","Software Detailed Design","Code","Test","Software Integration","System Integration"];
		var html = '';
		for(var key in DefectTypeData){
			var html1 = '<tr class="odd_row" style="width: 100%;"><th style="text-align:right; width: 30%">'+key+ ':</th>';
			var html2 = "";
			var arr = DefectTypeData[key];
			for(var i =0;i<arr.length;i++){
				var obj = arr[i];
				console.log(Object.keys(obj)[0]);
				console.log(Object.values(obj)[0]);
			
				html2 += '<td style="text-align:center; "> '+Object.values(obj)[0]+'</td>';
			}			
			html += html1+html2+'</tr>';
		}
		document.getElementById("defectTypeAndSousce").innerHTML = html;
	}

	function getRiskDate(){
		for(var i=0;i<RiskDate.length;i++){
			var obj = RiskDate[i];
			var key = Object.keys(obj)[0];
			var count = parseInt(obj[key]);
			if("Open" == key){
				document.getElementById("RiskStateOpen").innerHTML = count;
			}else if("In Analysis" == key){
				document.getElementById("RiskStateInAnalysis").innerHTML = count;
			}else if("Rejected" == key){
				document.getElementById("RiskStateRejected").innerHTML = count;
			}else if("Analyzed" == key){
				document.getElementById("RiskStateAnalyzed").innerHTML = count;
			}else if("In Monitoring" == key){
				document.getElementById("RiskStateInMonitoring").innerHTML = count;
			}else if("Postponed" == key){
				document.getElementById("RiskStatePostponed").innerHTML = count;
			}else if("Cloesd" == key){
				document.getElementById("RiskStateCloesd").innerHTML = count;
			}
		}
	};
</script>
</html>
